module.exports = function(){function q(b,c){function d(h){for(var m=[];b[a];)if(60==b.charCodeAt(a)){if(47===b.charCodeAt(a+1)){var f=a+2;a=b.indexOf(">",a);if(-1==b.substring(f,a).indexOf(h))throw h=b.substring(0,a).split("\n"),Error("Unexpected close tag\nLine: "+(h.length-1)+"\nColumn: "+(h[h.length-1].length+1)+"\nChar: "+b[a]);a+1&&(a+=1);break}else if(33===b.charCodeAt(a+1)){if(45==b.charCodeAt(a+2)){for(f=a;-1!==a&&(62!==b.charCodeAt(a)||45!=b.charCodeAt(a-1)||45!=b.charCodeAt(a-2)||-1==a);)a=b.indexOf(">",
a+1);-1===a&&(a=b.length);!0===c.keepComments&&m.push(b.substring(f,a+1))}else if(91===b.charCodeAt(a+2)&&91===b.charCodeAt(a+8)&&"cdata"===b.substr(a+3,5).toLowerCase()){f=b.indexOf("]]\x3e",a);-1==f?(m.push(b.substr(a+9)),a=b.length):(m.push(b.substring(a+9,f)),a=f+3);continue}else{f=a+1;a+=2;for(var n=!1;(62!==b.charCodeAt(a)||!0===n)&&b[a];)91===b.charCodeAt(a)?n=!0:!0===n&&93===b.charCodeAt(a)&&(n=!1),a++;m.push(b.substring(f,a))}a++;continue}f=g();m.push(f);"?"===f.tagName[0]&&(m.push.apply(m,
f.children),f.children=[])}else f=a,a=b.indexOf("<",a)-1,-2===a&&(a=b.length),f=b.slice(f,a+1),0<f.trim().length&&m.push(f),a++;return m}function e(){for(var h=a;-1===r.indexOf(b[a])&&b[a];)a++;return b.slice(h,a)}function g(){a++;for(var h=e(),m={},f=[];62!==b.charCodeAt(a)&&b[a];){var n=b.charCodeAt(a);if(64<n&&91>n||96<n&&123>n){n=e();for(var k=b.charCodeAt(a);k&&39!==k&&34!==k&&!(64<k&&91>k||96<k&&123>k)&&62!==k;)a++,k=b.charCodeAt(a);if(39===k||34===k){if(k=a+1,a=b.indexOf(b[a],k),k=b.slice(k,
a),-1===a)return{tagName:h,attributes:m,children:f}}else k=null,a--;m[n]=k}a++}47!==b.charCodeAt(a-1)?"script"==h?(f=a+1,a=b.indexOf("\x3c/script>",a),f=[b.slice(f,a)],a+=9):"style"==h?(f=a+1,a=b.indexOf("</style>",a),f=[b.slice(f,a)],a+=8):-1===x.indexOf(h)?(a++,f=d(h)):a++:a++;return{tagName:h,attributes:m,children:f}}function l(){var h=(new RegExp("\\s"+c.attrName+"\\s*=['\"]"+c.attrValue+"['\"]")).exec(b);return h?h.index:-1}c=c||{};var a=c.pos||0,r="\r\n\t>/= ",x=c.noChildNodes||["img","br",
"input","meta","link"],p=null;if(void 0!==c.attrValue)for(c.attrName=c.attrName||"id",p=[];-1!==(a=l());)a=b.lastIndexOf("<",a),-1!==a&&p.push(g()),b=b.substr(a),a=0;else p=c.parseNode?g():d("");c.filter&&(p=t(p,c.filter));c.setPos&&(p.pos=a);return p}function v(b){var c={};if(!b.length)return"";if(1===b.length&&"string"==typeof b[0])return b[0];b.forEach(function(e){if("object"===typeof e){c[e.tagName]||(c[e.tagName]=[]);var g=v(e.children);c[e.tagName].push(g);Object.keys(e.attributes).length&&
(g._attributes=e.attributes)}});for(var d in c)1==c[d].length&&(c[d]=c[d][0]);return c}function w(b,c){c=void 0===c?{}:c;var d={};if(!b.length)return d;if(1===b.length&&"string"==typeof b[0])return Object.keys(c).length?{_attributes:c,value:b[0]}:b[0];b.forEach(function(e){if("object"===typeof e){d[e.tagName]||(d[e.tagName]=[]);var g=w(e.children||[],e.attributes);d[e.tagName].push(g);Object.keys(e.attributes).length&&(g._attributes=e.attributes)}});return d}function t(b,c,d,e){d=void 0===d?0:d;e=
void 0===e?"":e;var g=[];b.forEach(function(l,a){"object"===typeof l&&c(l,a,d,e)&&g.push(l);if(l.children){var r=t(l.children,c,d+1,(e?e+".":"")+a+"."+l.tagName);g=g.concat(r)}});return g}function u(b){if(Array.isArray(b)){var c="";b.forEach(function(d){c+=" "+u(d);c=c.trim()});return c}return"object"===typeof b?u(b.children):" "+b}return{parse:q,simplify:v,simplifyLostLess:w,filter:t,stringify:function(b){function c(e){if(e)for(var g=0;g<e.length;g++)if("string"==typeof e[g])d+=e[g].trim();else{var l=
void 0,a=e[g];d+="<"+a.tagName;for(l in a.attributes)d=null===a.attributes[l]?d+(" "+l):-1===a.attributes[l].indexOf('"')?d+(" "+l+'="'+a.attributes[l].trim()+'"'):d+(" "+l+"='"+a.attributes[l].trim()+"'");d+=">";c(a.children);d+="</"+a.tagName+">"}}var d="";c(b);return d},toContentString:u,getElementById:function(b,c,d){b=q(b,{attrValue:c});return d?tXml.simplify(b):b[0]},getElementsByClassName:function(b,c,d){b=q(b,{attrName:"class",attrValue:"[a-zA-Z0-9- ]*"+c+"[a-zA-Z0-9- ]*"});return d?tXml.simplify(b):
b}}}();